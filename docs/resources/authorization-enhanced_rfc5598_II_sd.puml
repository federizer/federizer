@startuml Authorization-Enhanced Internet Mail Architecture, message flow part II.

/'
Message
Message User Agent (MUA)
    Author MUA (aMUA)
    Recipient MUA (rMUA)
Message Submission Agent (MSA)
    Author-focused MSA functions (aMSA)
    MHS-focused MSA functions (hMSA)
Message Transfer Agent (MTA)
Message Delivery Agent (MDA)
    Recipient-focused MDA functions (rMDA)
    MHS-focused MDA functions (hMDA)
Resource Fetch Agent (RFA)
Resource Access Agent (RAA)    
Mail Resource Store (MRS)
    Author MRS (aMRS)
    Recipient MRS (rMRS)    
    User Agent MRS (uMRS)
'/

'ADMD II.
participant "MTA" as MTA /'MTA'/
box "MDA" /'MDA'/
participant "hMDA" as hMDA /'MHS-focused MDA'/
participant "rMDA" as rMDA /'Recipient-focused MDA'/
end box
box "RFA, RAA" /'Resource Fetch Agent, Resource Access Agent'/
participant "rMRS" as rMRS /'Recipient MRS'/
end box
participant "rMUA" as rMUA /'MUA, uMRS optional'/

[-> MTA : 3.2 Placeholder message transfer (smtp)
MTA -> hMDA : 3.3 Placeholder message transfer (local, smtp, lmtp)
hMDA -> rMDA : 4.1 Delivery (D) transition
rMDA -> rMRS : 4.2 Placeholder message delivery (local, smtp)
rMRS ->[ : a) Fetch (sync) mail resources request (http), using the Internet Mail Federation Protocol
rMRS <--[ : b) Fetch (sync) mail resources response (http)
rMRS -> rMUA : 5 Mail resources retrieval/sync (local, pop, imap, http)

@enduml